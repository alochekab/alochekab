<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> 
<html xmlns="https://www.w3.org/1999/xhtml"> 
<head> 
<title>Leaflet.Control.Gps - Simple Example</title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> 
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">

<link rel="stylesheet" href="./dist/leaflet.css" />

<link rel="stylesheet" href="./src/leaflet-gps.css" />
<link rel="stylesheet" href="style.css" />
</head>

<body>

<div id="map"></div>

<input type="hidden" id="location">

<script src="./dist/leaflet.js"></script>
<script src="./src/leaflet-gps.js"></script>
<script>
	// config map
	var map = new L.Map('map', 
	{
		zoom: 12,
		center: new L.latLng([35.70163, 51.39211]),

	 });
	//  google layer map
	 googleStreets = L.tileLayer('http://{s}.google.com/vt/lyrs=m&x={x}&y={y}&z={z}',{
    maxZoom: 20,

    subdomains:['mt0','mt1','mt2','mt3']
});
	 var loc = L.icon({
		iconUrl: './images/loc.png',

		iconSize: [250, 250], // size of the icon
		shadowSize:   [250, 250], // size of the shadow
		// iconAnchor:   [50, 24], // point of the icon which will correspond to marker's location
		shadowAnchor: [1, 1],  // the same for the shadow
		// popupAnchor:  [-3, -76] // point from which the popup should open relative to the iconAnchor
	});
	 var marker = L.marker(
			[35.70163, 51.39211],
			{
				draggable: false,
				title: "",
				opacity: 1,
				icon:loc,


			});

		
	//base layer
	map.addLayer(googleStreets);	

	var gps = new L.Control.Gps({
		// autoActive:true,
		autoCenter:true
		
	});//inizialize control

	gps
	.on('gps:located', function(e) {
			// e.marker.bindPopup(e.latlng.toString()).openPopup()
		// console.log(e.latlng, map.getCenter())
		// console.log(map['_lastCenter']);
		marker.setLatLng(new L.LatLng(map['_lastCenter']['lat'], map['_lastCenter']['lng']))
		map.locate({setView: true, maxZoom: 18});  



	})
	.on('gps:disabled', function(e) {
		e.marker.closePopup()
		marker.setLatLng(new L.LatLng(map['_lastCenter']['lat'], map['_lastCenter']['lng']))
		map.locate({setView: true, maxZoom: 18});  


	});

	// isactive gps btn
	gps.addTo(map);
	// **********************************
	// **********************************
	// **********************************
	map.locate({setView: true, maxZoom: 25});  
	setTimeout(() => {
		marker.setLatLng(new L.LatLng(map['_lastCenter']['lat'], map['_lastCenter']['lng']))
	}, 1000);

	// **********************************
	// **********************************
	// **********************************

	// position fixed marker
	map.on('move', function () {
		marker.setLatLng(map.getCenter());
		//console.log(map.getCenter());
	});
	//Dragend event of map for update marker position
	map.on('dragend', function(e) {
		var cnt = map.getCenter();
	        var position = marker.getLatLng();
		lat = Number(position['lat']).toFixed(5);
		lng = Number(position['lng']).toFixed(5);
		
	});

	// **********************************
	// **********************************
	// **********************************
	// end select 
	marker.addTo(map);

	document.querySelector('.leaflet-marker-icon').addEventListener('click', function (){
			document.querySelector('#location').value=marker['_latlng']
			map.locate({setView: true, maxZoom: 18}); 	
			document.querySelector('.alarm').classList.add('active') 
			document.querySelector('.alarm').innerHTML = marker

		})

</script>
<div class="alarm">
	انتخاب شد
</div>
<style>
	.alarm{
		position: absolute;
		width: 100%;
		height: 10rem;
		background-color: #fff;
		box-shadow: 0 0 2px 1px #eee;
		bottom: 0;
		z-index: 9999;
		display: none;

	}
	.active.alarm{
		display: block;
	}
</style>

</body>
</html>
